#!/bin/sh

set -eu

soversion=$(sh ./tools/get-provider-soversion.sh)

substitute() {
    cat > "$2" <<EOF
# This file is autogenerated. DO NOT EDIT!
#
# Modifications should be made to $1 instead.
# This file is regenerated automatically in the clean target.
#
EOF
    sed -e "s/@PROVIDER_SOVERSION@/${soversion}/g" < "$1" >> "$2"
}

substitute ./debian/control.in ./debian/control
substitute ./debian/libstorage-framework-provider-1.install.in ./debian/libstorage-framework-provider-1-${soversion}.install
substitute ./debian/libstorage-framework-provider-1.shlibs.in ./debian/libstorage-framework-provider-1-${soversion}.shlibs

exit 0
